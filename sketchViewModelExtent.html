<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Search Widget - 4.9</title>

  <style>
    html,
    body,
    #viewDiv {
	height: 100%;
	width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://jsdev.arcgis.com/4.10/esri/css/main.css">
  <script src="https://jsdev.arcgis.com/4.10/"></script>

  <script>
	require([
		"esri/Map",
		"esri/views/MapView",
		"esri/Graphic",
		"esri/geometry/Polygon",
		"esri/geometry/Extent",
		"esri/symbols/SimpleFillSymbol",
		"esri/layers/GraphicsLayer",
		"esri/widgets/Sketch/SketchViewModel"
	], function (
		Map,
		MapView,
		Graphic,
		Polygon,
		Extent,
		SimpleFillSymbol,
		GraphicsLayer,
		SketchViewModel
	) {


		var map = new Map({
			basemap: "topo"
		});

		var view = new MapView({
			container: "viewDiv",
			map: map
		});

		var maskLayer = new GraphicsLayer({ id: "myMask" });
		var graphicsLayer = new GraphicsLayer({ id: "myFeatures" });
		map.add(maskLayer);
		map.add(graphicsLayer);

		// make our polygon symbol completely transparent and let the mask to the visual work
		var polygonSymbol = new SimpleFillSymbol({
			color: [0, 0, 0, 0],
			outline: {
			  color: [0, 0, 0, 0],
			  width: "2px"
			}
		});

		var sketchViewModel = new SketchViewModel({
		  updateOnGraphicClick: true,
		  layer: graphicsLayer,
		  view: view,
		  updatePolygonSymbol: polygonSymbol,
		  polygonSymbol: polygonSymbol
    	});




		var palmspringsExt = [[-116.6427356737,33.75709903],[-116.3734536237,33.75709903],[-116.3734536237,33.9002301673],[-116.6427356737,33.9002301673],[-116.6427356737,33.75709903]];

		var polyForExtent = new Polygon({ rings: palmspringsExt });

		graphicsLayer.add(
			new Graphic(polyForExtent.extent,polygonSymbol)
        );
        sketchViewModel.update([new Graphic(polyForExtent.extent,polygonSymbol)], {
                  tool: "transform",
                  enableRotation: false,
                  toggleToolOnClick: false
                });
        maskLayer.add(getMask(polyForExtent.extent))

		view.extent = polyForExtent.extent.expand(1.2);


		function getMask(shape) {
			console.log(shape);
			
			console.log(shape.type);
			if (shape.type === "undefined") return false;
			var outerRing = [[180, 90], [180, -90], [-180, -90], [-180, 90], [-180, 90], [180, 90]];
			var innerRing;
			console.log(shape.type);
			if (shape.type === "polygon") {
				innerRing = shape.rings.reverse();
			} else if (shape.type === "extent") {
				console.log(new Polygon.fromExtent(shape));
				var newP = new Polygon.fromExtent(shape);
				innerRing = newP.rings;
				console.log(innerRing);
			}
			if (!innerRing) return false;
			console.log(innerRing);
			var maskPoly = new Polygon({ rings: [outerRing, innerRing] });
			var maskSymbol = new SimpleFillSymbol({
				color: [0, 0, 0, 0.5],
				outline: {
				  color: [0, 0, 0, 1],
				  width: "2px"
				}
			});
			console.log(maskPoly);
			var maskGraphic = new Graphic(maskPoly, maskSymbol);
			return maskGraphic;
		}
	});
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>
